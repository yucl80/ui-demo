<!DOCTYPE html>
<html>

<body>

    <h1>Test SVG</h1>
    <div id="toolbar" style="width: 100px;height: 80px;background-color: #666666;display: none;">
      <div>菜单1</div>
      <div>菜单2</div>
    </div>
    <div id="cm">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css"
            height="781px" preserveAspectRatio="none" style="width:567px;height:781px;background:#FFFFFF;" version="1.1"
            viewBox="0 0 567 781" width="567px" zoomAndPan="magnify">
            <defs />
            <g>
                <!--MD5=[8fc3522a43f8c7199df5e09e5bb0188e]
        entity user-->
                <g id="elem_user">
                    <rect fill="#08427B" height="119.2188" rx="2.5" ry="2.5" style="stroke:#073B6F;stroke-width:0.5;"
                        width="217" x="8.5" y="7" />
                    <image height="48" width="48" x="93"
                        xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAIAAADYYG7QAAACbklEQVR4Xu1Wq04FMRS8cj+BT+AXsDgMHwAfQILGXUWQgMQQggRDgsBgSLiWgEIREhRIEAjsMum5dLtzetreXgKE7GTUbh/TOY921CyP/xRH+tPvchCU4yAox0FQjt8gaHF9b2XreGnjYGF1R/+dlfWCsP3uyeTt/aMNcPfwDHF6cDkrBcEPkhLi6OJGTylkjSDEKKFGUK2pRhDiwvvHUBe7iKDN/fOnl1esCBuQJfQX2/DOBqBbz726fWzdymfX93Ba786CYHV6XT0ggbDu1rZP6S9kaU09QUhVmiMIfZIjFgILyiwo438O2sWeIOv0iKAfU5hAAp9G2h4P6l49QYgrD3eAt9kxUfiIIC/53xcoaj1B48NLHu4QGptYmhAeI1EKoQAWZEUahmfHaFCFSuUSdLviKtNH0ZVvGRkC9lByIDSkCfVBKzdaUOM8wJbQDim+TIjZTLImIuJYGbTaZkRQIS2fkHC6u5STBcEeLIfzeSYeFfiFE8MtiID/iXMLaeWo7k4QVreaHmJvhaCQiD4v6oBUw5HCkZ2gaBUIMC199CzTORdqmgqyEqJ19vioYSZclLeHXL1hTBECNAhvMyYiiCW9sQ260VSQdSH46tVFWw7fOBLH9hGYCrI2k9SBGv4xIxAy2chKU997U4J848q+D0sgiWI9KFhQNGRiY8LnmeCvtsRenaBoxiXMq4PYoFtA+Lzpyh5mwgxPcbj8Ki2BXKXISNoo7L3cqYnzp3OI6G1KzAiycrAO/1EQyKvOAf200swLsl7+FYhe78S8oMa1IlQmGkk1EawSNU2hoJ/kICjHQVCOg6AcB0E5fgLPSUakWeua4wAAAABJRU5ErkJggg=="
                        y="17" /><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold"
                        lengthAdjust="spacing" textLength="90" x="72" y="79.8516">Customer</text><text fill="#FFFFFF"
                        font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="115"
                        y="96.6201">
                    </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing"
                        textLength="193" x="22.5" y="112.917">People that need products</text>
                </g>
                <!--MD5=[33573e971ff506c0f246109ca3fd77bd]
        entity spa-->
                <g id="elem_spa">
                    <rect fill="#438DD5" height="149.4844" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;"
                        width="220" x="7" y="215" />
                    <image height="48" width="48" x="93"
                        xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAIAAADYYG7QAAACnUlEQVR4Xu1XTWpWQRDM3eYAXiAH8AIewAPoypW4c+HCZXauxJ3gxoVIBCEggUBAUSEhIDyLr6HpdE/VzHvfB7r4ilqE9+b11Nc/NZOT9uTTf8WT+ujf8ihoxKOgEQ8g6MGzz0/fXD4++1ZfbeBegh69vnh7/nMJ+HDxe09lWwQ9fPn17OP3qKNis7IVgkzHr9s/efNl6T5cds/xCRJZozGOBZ2++PLq/fXlj7u8W8Dzd1epdglQhgUzyqgga9Xzq5scuwcshu78tAfLGZJdd1SC0AE5Egfyt+ErpLzuSwXpAiUgN/YVfnd+x7FO0PxvRWfEDydLvOzGsO7bmKDhVDtSN6Bt8woCbFH3bUwQpiYH6AH5qN9Olhtb1G8bEwRPywF68DHGH54qzGZe1wOzzb6gmfaMXYmGiM3EfDKCTX5fEHwlByhAJmyxO5CP20zFsUXdtzFBYA5wH8iBr4QP2cPYp8Mk1R2NVJCO6GaYVnqSXGUXzISaEKQdxROeWtiTpIvOTKgJQeKwjKWpQ+5ahZkxE2pCkMi516XtDCLR34rjNlY8kQpidiKyXcnS7BNaSQWxQ2DmTuNkSRJBqKBurDgdqA4yz+jLuud0LHoiFdR6VhT9XvtCPFXyO25CTQtKW0YzZB3miK2WHCTGqVSCUqB4PmuXMnhd0lHdvSM4laA0I24w3faqYHaV7nSJSlC0IpQA3WBkw1yBI90YQwkTalrQsFG2QZhQ04Lwy/QobQACiplvWlDbnZHiDFkLXSzjQJARssRJOQN8zm5kiVOCjKjgzLQnYBp0jRJXCDJiyuqVowuoZxdnwdWCjPA60e94xf6pGHKjIGO9zEMK+4drknsJavf7fb5zBfcVZETbrupcwcMIOiCPgkY8ChrxL89rtiXB517ZAAAAAElFTkSuQmCC"
                        y="225" /><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold"
                        lengthAdjust="spacing" textLength="35" x="99.5" y="287.8516">SPA</text><text fill="#FFFFFF"
                        font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing"
                        textLength="56" x="89" y="302.7637">[angular]</text><text fill="#FFFFFF"
                        font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="115"
                        y="318.5889"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14"
                        lengthAdjust="spacing" textLength="200" x="17" y="334.8857">The main interface that
                        the</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing"
                        textLength="172" x="31" y="351.1826">customer interacts
                        with</text>
                </g>
                entity api--><g id="elem_api">
                    <rect fill="#438DD5" height="133.1875" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;"
                        width="199" x="17.5" y="465.5" />
                    <image height="48" width="48" x="93"
                        xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAIAAADYYG7QAAACsklEQVR4Xu2XT0ocQRTGvVsfYC7gAbyAB8gB4sqVuMvCRZbusgruAm5ciBgICCIIgiEJRASh86M/eBT9OlWvq0oUdPgW3W96pn7z1ftTszV8PH9V2vKhl9U7UElvAGizf7F9+N3Hg+oPhI6+3flgUP2BcOj06o+PB9Uf6MPx9dfLXz4eVH+gy9u/Bye3Ph5UZ6C9LzfjOLJr/q2gegKxWdC02DN0BJI3Leks9QE6Pruf0bBrIOKZfzivViAWJouhscoiQh8iWNcem4BY8ubnIzQ4pAiW/H54stsK1QPhhGisL3PxkklNxqR5oxJraYlSJRD2jNPLEkWZtPPph394lZqA2DKLiG/385V/eJUqgRA05K/dcp3uYLXqgZQ0tmXKaF60H/9wXPVAiBRO249MSm2rUBPQMNWa5Q0X7ZnUCjRMPtl4Vy+o69FSB6Bh8kYXwC22aYiDZ5J1QBqZ9OLFfqMp5uPg8ikaFf4VsaJA1BRfR6kvokizxTbu7wcfB8t/MFUIyMYWFcSm4BDS6QLJM7xB7BfcMsMPNbWGvEkhIIkvkvm2tqRblgcO/zIZDWWxKawAMuV/4v+kplA8sq0GYjsWM9eEQ6w984kI3hRphjogdT9lKLsgca1OrZedGFV6KOjraqBh8kCZpNFhIkJ81qYzVbmoGqBnVQ0QlZWOi1RKoMW3gqoBsjQap85EMulsZMGx4RASBSIVqBGrHWzAJyWyoXCrtplpRUUVgDBfzTdSsXlpN318phwQX6GfTvm0/Gjc1Wzxb3nlgNRCNMXGqfFgFYZpkNkss4lmQ01Zzw5qE4krzXVY8AulygGl4ruURrakVkVQ6kJzzYaa1Zr6lp4pFmAUSBKTJgPaTMcuExEeMO7Z5A9u+jogSempVSUNBxv72s3UpLhqgJ5V70AlvTqgf2H6uTXfTevfAAAAAElFTkSuQmCC"
                        y="475.5" /><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold"
                        lengthAdjust="spacing" textLength="29" x="102.5" y="538.3516">API</text><text fill="#FFFFFF"
                        font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing"
                        textLength="34" x="100" y="553.2637">[java]</text><text fill="#FFFFFF" font-family="sans-serif"
                        font-size="14" lengthAdjust="spacing" textLength="4" x="115" y="569.0889"> </text><text
                        fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="179"
                        x="27.5" y="585.3857">Handles all business logic</text>
                </g>
                <!--MD5=[7468467f3b6b392f1d176d828c753b77]
        entity db-->
                <g id="elem_db">
                    <path
                        d="M349.5,463 C349.5,453 450,453 450,453 C450,453 550.5,453 550.5,463 L550.5,601.4844 C550.5,611.4844 450,611.4844 450,611.4844 C450,611.4844 349.5,611.4844 349.5,601.4844 L349.5,463 "
                        fill="#438DD5" style="stroke:#3C7FC0;stroke-width:0.5;" />
                    <path d="M349.5,463 C349.5,473 450,473 450,473 C450,473 550.5,473 550.5,463 " fill="none"
                        style="stroke:#3C7FC0;stroke-width:0.5;" />
                    <image height="48" width="48" x="426"
                        xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAIAAADYYG7QAAADJ0lEQVR4Xu2XMWpbQRCGfbc9gC/gA+QCOYAPEFWpQroUKlKqSxXSGdSkCMGBgCEYDIaEJGATMCgf++Hh5a303tt9luNC8PNYrVaaTzOzM6Oj9OLTk9JRufV/dQAa0wFoTLOAjl9+LjdnqhHo+duL09U3ns/efC3fnaM6IFzy6sPV4t1l+IZ1eWyOKoBAOb+64Ylwj75Znl2XJ+doKtDq43eU7glOXn8hXrhnffEbvvJ8s6YC4Q9t4xsWhAwm4NwvzzdrKlDKiRxA789//rq9w2c4CawHDFwFUMpMEEQi8xIy+UgvFiBCjPPKz05UHVDKEFglZDos/XvRoIHs8scfxDHOlN8wrGqglBMcZwSH8QLRCJJVXkD9R2Q5ML2EtgARkc1mEz7giauwrdVePrEJPecn5lkLUMpOwpIBEs680U8pQ0Ogz8w8y9hoejUCRTXi1yNegoWTlDthmx0Xnh9magTi55IohsxkwgzpIlb3ZC+1cWEEd6sagfhSnYQ9o8NPB4ggEr6o3bwsmx00A/nUCOTdAQXzoOADXmLed8H1ukFmgTCfeFpaB6LWAoQluxgB0gGajANAWI14CjdA0FMLELYh0B6WDFnKoCws2XhiOkRX1UB2U1PV8chY6AzX5aemqw4oyrHpwoJksst6lbx65Qenqw7IrIQDq7jEBPKeg+LUNnMaqQACwrzh6a1xv1t4wH0kIMxzp1a5Y6zzgBaBk8x8InCPAWSANAxE+MYILvOAFvV670BWkeAgXlH48Yedtbuz36SO4ku2+pdjmedofeZtB9f66/k9XvveV9s75XAE88b5ri2CBI/f0KadQFo1eb1TAHWjk3L4Yg3HaZ7/2wp0aCcQ5r1HEhgUO4YmF3nmsm+En7qIbdoOBATRCWeYJa5NJmv0ujNZe6w3DDVoOxCyN7nuJpNxAVcXdj8SqT1HO4FO8iRvOGKmWeY+H/3BicfIzm8aaidQykz2CktR7Pdm0OM87VsRyi+p1RCQwpJTqRCLPAqme/fYLjzWpWzWOJCyBMc/isAKPYh70nSgkG3EfIoE6sV0jqqB9q0D0JgOQGN6ckB/AQa02BAGMZ/XAAAAAElFTkSuQmCC"
                        y="477" /><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold"
                        lengthAdjust="spacing" textLength="87" x="406.5" y="539.8516">Database</text><text
                        fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic"
                        lengthAdjust="spacing" textLength="92" x="404" y="554.7637">[Microsoft SQL]</text><text
                        fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4"
                        x="448" y="570.5889"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14"
                        lengthAdjust="spacing" textLength="177" x="359.5" y="586.8857">Holds product, order
                        and</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing"
                        textLength="140" x="380" y="603.1826">invoice
                        information</text>
                </g>
                <!--MD5=[f01566b2b60b280485eda08a2d99c8d8]
        link user to spa-->
                <g id="link_user_spa">
                    <path d="M117,126.144 C117,150.828 117,179.977 117,206.715 " fill="none" id="user-to-spa"
                        style="stroke:#666666;stroke-width:1.0;" />
                    <polygon fill="#666666" points="117,214.928,120,206.928,114,206.928,117,214.928"
                        style="stroke:#666666;stroke-width:1.0;" /><text fill="#666666" font-family="sans-serif"
                        font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="34" x="122"
                        y="168.1387">Uses</text><text fill="#666666" font-family="sans-serif" font-size="12"
                        font-style="italic" lengthAdjust="spacing" textLength="42" x="118" y="182.1074">[https]</text>
                </g>
                <!--MD5=[b20751f21bc3c5e56073fe913b5ac5ab]
        link spa to api-->
                <g id="link_spa_api">
                    <path d="M117,364.292 C117,393.7 117,427.488 117,456.923 " fill="none" id="spa-to-api"
                        style="stroke:#666666;stroke-width:1.0;" />
                    <polygon fill="#666666" points="117,465.103,120,457.103,114,457.103,117,465.103"
                        style="stroke:#666666;stroke-width:1.0;" /><text fill="#666666" font-family="sans-serif"
                        font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="34" x="122"
                        y="406.1387">Uses</text><text fill="#666666" font-family="sans-serif" font-size="12"
                        font-style="italic" lengthAdjust="spacing" textLength="42" x="118" y="420.1074">[https]</text>
                </g>
                <!--MD5=[1b9dbcfdb69d97b7ce5f2d963fc4ed75]
        link api to db-->
                <g id="link_api_db">
                    <path d="M216.911,532 C256.072,532 301.118,532 341.107,532 " fill="none" id="api-to-db"
                        style="stroke:#666666;stroke-width:1.0;" />
                    <polygon fill="#666666" points="349.297,532,341.297,529,341.297,535,349.297,532"
                        style="stroke:#666666;stroke-width:1.0;" /><text fill="#666666" font-family="sans-serif"
                        font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="96" x="235"
                        y="526.1387">Reads/Writes</text>
                </g>
                <rect fill="none" height="130.0781" id="_legend" rx="7.5" ry="7.5" style="stroke:none;stroke-width:1.0;"
                    width="153" x="392.5" y="635.4844" /><text fill="#000000" font-family="sans-serif" font-size="14"
                    font-weight="bold" lengthAdjust="spacing" textLength="57" x="398.5" y="656.4795">Legend</text><text
                    fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4"
                    x="455.5" y="656.4795"> </text>
                <rect fill="#08427B" height="16.2969" style="stroke:none;stroke-width:1.0;" width="141" x="398.5"
                    y="659.7813" /><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing"
                    textLength="50" x="402.5" y="672.7764">person</text>
                <rect fill="#1168BD" height="16.2969" style="stroke:none;stroke-width:1.0;" width="141" x="398.5"
                    y="676.0781" /><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing"
                    textLength="52" x="402.5" y="689.0732">system</text>
                <rect fill="#438DD5" height="16.2969" style="stroke:none;stroke-width:1.0;" width="141" x="398.5"
                    y="692.375" /><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing"
                    textLength="69" x="402.5" y="705.3701">container</text>
                <rect fill="#686868" height="16.2969" style="stroke:none;stroke-width:1.0;" width="141" x="398.5"
                    y="708.6719" /><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing"
                    textLength="114" x="402.5" y="721.667">external person</text>
                <rect fill="#999999" height="16.2969" style="stroke:none;stroke-width:1.0;" width="141" x="398.5"
                    y="724.9688" /><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing"
                    textLength="116" x="402.5" y="737.9639">external system</text>
                <rect fill="#B3B3B3" height="16.2969" style="stroke:none;stroke-width:1.0;" width="141" x="398.5"
                    y="741.2656" /><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing"
                    textLength="133" x="402.5" y="754.2607">external container</text>
                <line style="stroke:#FFFFFF;stroke-width:1.0;" x1="398.5" x2="539.5" y1="643.4844" y2="643.4844" />
                <line style="stroke:#FFFFFF;stroke-width:1.0;" x1="398.5" x2="539.5" y1="659.7813" y2="659.7813" />
                <line style="stroke:#FFFFFF;stroke-width:1.0;" x1="398.5" x2="539.5" y1="676.0781" y2="676.0781" />
                <line style="stroke:#FFFFFF;stroke-width:1.0;" x1="398.5" x2="539.5" y1="692.375" y2="692.375" />
                <line style="stroke:#FFFFFF;stroke-width:1.0;" x1="398.5" x2="539.5" y1="708.6719" y2="708.6719" />
                <line style="stroke:#FFFFFF;stroke-width:1.0;" x1="398.5" x2="539.5" y1="724.9688" y2="724.9688" />
                <line style="stroke:#FFFFFF;stroke-width:1.0;" x1="398.5" x2="539.5" y1="741.2656" y2="741.2656" />
                <line style="stroke:#FFFFFF;stroke-width:1.0;" x1="398.5" x2="539.5" y1="757.5625" y2="757.5625" />
                <line style="stroke:#FFFFFF;stroke-width:1.0;" x1="398.5" x2="398.5" y1="643.4844" y2="757.5625" />
                <line style="stroke:#FFFFFF;stroke-width:1.0;" x1="539.5" x2="539.5" y1="643.4844" y2="757.5625" />
            </g>
        </svg>
    </div>
    <script>
        function showToolbar(obj) {
            const rect = obj.getBoundingClientRect();
            var toolbar = document.getElementById("toolbar");
            toolbar.style.position = 'absolute';           
            toolbar.style.left = rect.left + window.scrollX +'px';
            toolbar.style.top = rect.top + window.scrollY +'px';
            toolbar.style.zIndex = 10000000;
            toolbar.style.display="block";
        }

        function f() {
            document.querySelectorAll('svg').forEach(function (item) {
                //左键菜单
                item.addEventListener('click', function (event) {
                    if (event.target.parentNode.id) {
                        alert('svg clicked was: ' + event.target.parentNode.id);
                    }
                });
                //右键菜单
                item.addEventListener('contextmenu',function(event){
                    if (event.target.parentNode.id) {
                        showToolbar(event.target.parentNode);
                    }
                })
            })

            //调整连接线文字的位置，尽量让文本居中
            document.querySelectorAll('g').forEach(function (item) {
                var x = item.getAttribute("id");
                if (x != null && x.startsWith('link_')) {
                    var path = item.getElementsByTagName('path')[0].getAttribute('d');
                    var los = path.replaceAll('C', '').substr(1).split(' ');
                    var yposEq = false;
                    for (var i = 0; i < los.length - 2; i++) {
                        if (los[i].split(',')[1] == los[i + 1].split(',')[1]) {
                            yposEq = true;
                            break;
                        }
                    }
                    if (!yposEq) {
                        var texts = item.getElementsByTagName('text');
                        for (var i = 0; i < texts.length; i++) {
                            var txt = texts[i];
                            var x = parseInt(txt.getAttribute('x')) - parseInt(txt.getAttribute('textLength') / 2);
                            if (x > 0) {
                                txt.setAttribute('x', x);
                            }

                        }
                    }

                }

            });

        }
        f();
    </script>
</body>

</html>